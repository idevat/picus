{{#bs-tab customTabs=true activeId=activeTab as |tab|}}

{{#bs-nav type="tabs" as |nav|}}
  {{#nav.item active=(eq tab.activeId "users")}}<a {{action 'setActiveTab' tab.select "users"}}>Users &amp; Groups</a>{{/nav.item}}
  {{#nav.item active=(eq tab.activeId "roles")}}<a {{action 'setActiveTab' tab.select "roles"}}>Roles</a>{{/nav.item}}
  {{#nav.item active=(eq tab.activeId "permissions")}}<a {{action 'setActiveTab' tab.select "permissions"}}>Permissions</a>{{/nav.item}}
{{/bs-nav}}

<div class="tab-content">
{{#tab.pane elementId="users" title="Users & Groups"}}
{{#attr-list
    title='User Management'
    attributes=model.updatingCluster.firstObject.aclUsers
    onDeleteAction=(route-action 'delete')
    onAppendAction=(route-action 'appendUser')
    onDeleteMultipleAction=(route-action 'deleteMultiple')
    validations=model.nameValidation
    as |form mode attr f|
}}
  {{#if (eq mode 'edit')}}
    {{f.text-field 'name'}}
  {{else}}
    <td>{{attr.name}}</td>
  {{/if}}
{{/attr-list}}

{{#attr-list
    title='Group Management'
    attributes=model.updatingCluster.firstObject.aclGroups
    onDeleteAction=(route-action 'delete')
    onAppendAction=(route-action 'appendGroup')
    onDeleteMultipleAction=(route-action 'deleteMultiple')
    validations=model.nameValidation
    as |form mode attr f|
}}
  {{#if (eq mode 'edit')}}
    {{f.text-field 'name'}}
  {{else}}
    <td>{{attr.name}}</td>
  {{/if}}
{{/attr-list}}

{{/tab.pane}}
{{#tab.pane elementId="roles" title="Roles"}}
{{#attr-list
    title='Roles'
    attributes=model.updatingCluster.firstObject.aclRoles
    onDeleteAction=(route-action 'delete')
    onAppendAction=(route-action 'appendRole')
    onDeleteMultipleAction=(route-action 'deleteMultiple')
    validations=model.nameValidation
    as |form mode attr f|
}}
  {{#if (eq mode 'edit')}}
      {{f.text-field 'name'}}
      {{f.text-field 'description'}}
  {{else}}
    <td>{{attr.name}}</td>
    <td>{{attr.description}}</td>
  {{/if}}
{{/attr-list}}

{{/tab.pane}}
{{#tab.pane elementId="permissions" title="Permissions"}}
{{#each model.updatingCluster.firstObject.aclRoles as |role|}}
  <h3>{{role.name}}</h3>

  {{#attr-list
      title=role.name
      attributes=role.permissions
      onDeleteAction=(route-action 'delete')
      onAppendAction=(route-action 'appendPermission' role.name)
      onDeleteMultipleAction=(route-action 'deleteMultiple')
      validations=model.xpathValidation
      as |form mode attr f|
  }}
  {{#if (eq mode 'edit')}}
      <!-- @note: it is required to handle 'empty' value which is obtained when user does not change the option. -->
      {{f.select-field "operation" "deny read write"}}
      {{f.text-field 'xpath'}}
  {{else}}
      <td>{{attr.operation}}</td>
      <td>{{attr.xpath}}</td>
  {{/if}}
  {{/attr-list}}

{{else}}
  No Roles defined.
{{/each}}

{{/tab.pane}}
</div>
{{/bs-tab}}
